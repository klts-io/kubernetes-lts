name: Verify

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

  workflow_dispatch:

jobs:
  Patch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Verify patch
        run: |
          make verify-patch
      - name: Verify patch format
        run: |
          make verify-patch-format

  Test-v1-18-20-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-18-20-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.18.20-cve.0
        run: |
          make v1.18.20-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-18-20-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-18-20-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.18.20-cve.0
        run: |
          make v1.18.20-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-18-20-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-18-20-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.18.20-cve.0
        run: |
          make v1.18.20-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-17-17-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-17-17-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.17.17-cve.0
        run: |
          make v1.17.17-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-17-17-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-17-17-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.17.17-cve.0
        run: |
          make v1.17.17-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-17-17-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-17-17-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.17.17-cve.0
        run: |
          make v1.17.17-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-16-15-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-16-15-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.16.15-cve.0
        run: |
          make v1.16.15-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-16-15-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-16-15-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.16.15-cve.0
        run: |
          make v1.16.15-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-16-15-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-16-15-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.16.15-cve.0
        run: |
          make v1.16.15-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-15-12-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-15-12-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.15.12-cve.0
        run: |
          make v1.15.12-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-15-12-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-15-12-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.15.12-cve.0
        run: |
          make v1.15.12-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-15-12-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-15-12-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.15.12-cve.0
        run: |
          make v1.15.12-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-14-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-14-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.14.10-cve.0
        run: |
          make v1.14.10-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-14-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-14-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.14.10-cve.0
        run: |
          make v1.14.10-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-14-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-14-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.14.10-cve.0
        run: |
          make v1.14.10-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-13-12-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-13-12-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.13.12-cve.0
        run: |
          make v1.13.12-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-13-12-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-13-12-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.13.12-cve.0
        run: |
          make v1.13.12-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-13-12-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-13-12-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.13.12-cve.0
        run: |
          make v1.13.12-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-12-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-12-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.12.10-cve.0
        run: |
          make v1.12.10-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-12-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-12-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.12.10-cve.0
        run: |
          make v1.12.10-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-12-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-12-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.12.10-cve.0
        run: |
          make v1.12.10-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-11-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-11-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.11.10-cve.0
        run: |
          make v1.11.10-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-11-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-11-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.11.10-cve.0
        run: |
          make v1.11.10-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-11-10-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-11-10-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.11.10-cve.0
        run: |
          make v1.11.10-cve.0
      - name: Test integration
        run: |
          make test-integration

  Test-v1-10-13-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-10-13-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.10.13-cve.0
        run: |
          make v1.10.13-cve.0
      - name: Test
        run: |
          make test

  Test-Cmd-v1-10-13-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-10-13-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.10.13-cve.0
        run: |
          make v1.10.13-cve.0
      - name: Test cmd
        run: |
          make test-cmd

  Test-Integration-v1-10-13-cve-0:
    needs: Patch
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Cache workdir
        uses: actions/cache@v2
        env:
          cache-name: workdir
        with:
          path: |
            workdir
            /tmp/kubepatch/
          key: ${{ runner.os }}-build-${{ env.cache-name }}-v1-10-13-cve-0
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}
      - name: Install dependent
        run: |
          git config --global user.name "bot"
          make dependent
      - name: Checkout to v1.10.13-cve.0
        run: |
          make v1.10.13-cve.0
      - name: Test integration
        run: |
          make test-integration
